# Todoist å®¢æˆ·ç«¯ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

å·²åœ¨ `me.xiaozhangup.bot.util.doist` åŒ…ä¸‹æˆåŠŸåˆ›å»ºäº† Todoist API å®¢æˆ·ç«¯ï¼Œæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š

### âœ… å·²å®ç°åŠŸèƒ½

1. **é¡¹ç›®ç®¡ç† (Project)**
   - åˆ›å»ºé¡¹ç›® (`createProject`) - æ”¯æŒç®€åŒ–ç‰ˆå’Œå®Œæ•´ç‰ˆ
   - è·å–é¡¹ç›®åˆ—è¡¨ (`getProjects`)
   - è·å–å•ä¸ªé¡¹ç›® (`getProject`)
   - æ›´æ–°é¡¹ç›® (`updateProject`) - æ”¯æŒç®€åŒ–ç‰ˆå’Œå®Œæ•´ç‰ˆ
   - åˆ é™¤é¡¹ç›® (`deleteProject`)

2. **æ¿å—ç®¡ç† (Section)**
   - åˆ›å»ºæ¿å— (`createSection`)
   - è·å–æ¿å—åˆ—è¡¨ (`getSections`)
   - è·å–å•ä¸ªæ¿å— (`getSection`)
   - æ›´æ–°æ¿å— (`updateSection`)
   - åˆ é™¤æ¿å— (`deleteSection`)

3. **ä»»åŠ¡ç®¡ç† (Task)**
   - åˆ›å»ºä»»åŠ¡ (`createTask`) - æ”¯æŒç®€åŒ–ç‰ˆå’Œå®Œæ•´ç‰ˆ
   - è·å–ä»»åŠ¡åˆ—è¡¨ (`getTasks`) - æ”¯æŒæŒ‰é¡¹ç›®ã€æ¿å—ã€æ ‡ç­¾ç­›é€‰
   - è·å–å•ä¸ªä»»åŠ¡ (`getTask`)
   - æ›´æ–°ä»»åŠ¡ (`updateTask`) - æ”¯æŒç®€åŒ–ç‰ˆå’Œå®Œæ•´ç‰ˆ
   - å®Œæˆä»»åŠ¡ (`closeTask`)
   - é‡æ–°æ‰“å¼€ä»»åŠ¡ (`reopenTask`)
   - åˆ é™¤ä»»åŠ¡ (`deleteTask`)

4. **æŠ€æœ¯å®ç°**
   - âœ… ä½¿ç”¨ `kotlinx.serialization` è¿›è¡Œ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–
   - âœ… ä½¿ç”¨ `java.net` (HttpURLConnection) è¿›è¡Œç½‘ç»œè¯·æ±‚
   - âœ… å®Œæ•´çš„ç±»å‹å®‰å…¨å’Œæ•°æ®æ¨¡å‹
   - âœ… å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

## æ–‡ä»¶ç»“æ„

```
src/main/kotlin/me/xiaozhangup/bot/util/doist/
â”œâ”€â”€ TodoistClient.kt      # ä¸»å®¢æˆ·ç«¯ç±»
â”œâ”€â”€ TodoistModels.kt      # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ TodoistExample.kt     # ä½¿ç”¨ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ SimpleExample.kt      # ç®€å•ç¤ºä¾‹
â”œâ”€â”€ TodoistException.kt   # å¼‚å¸¸å®šä¹‰
â”œâ”€â”€ README.md            # è‹±æ–‡æ–‡æ¡£
â””â”€â”€ ä½¿ç”¨è¯´æ˜.md          # ä¸­æ–‡è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–å®¢æˆ·ç«¯

```kotlin
val client = TodoistClient("your-api-token-here")
```

### 2. é¡¹ç›®æ“ä½œç¤ºä¾‹

```kotlin
// åˆ›å»ºé¡¹ç›®ï¼ˆç®€åŒ–ç‰ˆï¼‰
val project = client.createProject(
    name = "æˆ‘çš„å·¥ä½œé¡¹ç›®",
    color = "blue",
    isFavorite = true,
    viewStyle = "list"  // "list" æˆ– "board"
)

// è·å–æ‰€æœ‰é¡¹ç›®
val projects = client.getProjects()
projects.forEach {
    println("é¡¹ç›®: ${it.name}, é¢œè‰²: ${it.color}")
}

// è·å–å•ä¸ªé¡¹ç›®
val projectDetail = client.getProject(project.id)

// æ›´æ–°é¡¹ç›®
val updated = client.updateProject(
    projectId = project.id,
    name = "æ›´æ–°çš„é¡¹ç›®åç§°",
    color = "green"
)

// åˆ é™¤é¡¹ç›®
client.deleteProject(project.id)
```

### 3. æ¿å—æ“ä½œç¤ºä¾‹

```kotlin
// åˆ›å»ºæ¿å—
val section = client.createSection(
    name = "å·¥ä½œä»»åŠ¡",
    projectId = project.id
)

// è·å–æ‰€æœ‰æ¿å—
val sections = client.getSections(projectId = project.id)

// æ›´æ–°æ¿å—åç§°
val updated = client.updateSection(section.id, "é‡è¦å·¥ä½œ")

// åˆ é™¤æ¿å—
client.deleteSection(section.id)
```

### 4. ä»»åŠ¡æ“ä½œç¤ºä¾‹

```kotlin
// åˆ›å»ºä»»åŠ¡ï¼ˆç®€åŒ–ç‰ˆï¼‰
val task = client.createTask(
    content = "å®Œæˆé¡¹ç›®æŠ¥å‘Š",
    description = "åŒ…å«æ‰€æœ‰ç»Ÿè®¡æ•°æ®",
    projectId = project.id,
    priority = 4,  // 1-4ï¼Œ4æœ€é«˜
    dueString = "tomorrow at 18:00"
)

// è·å–ä»»åŠ¡
val tasks = client.getTasks(sectionId = section.id)

// æ›´æ–°ä»»åŠ¡
client.updateTask(
    taskId = task.id,
    content = "å®Œæˆé¡¹ç›®æŠ¥å‘Šï¼ˆæ›´æ–°ï¼‰",
    priority = 3
)

// å®Œæˆä»»åŠ¡
client.closeTask(task.id)

// åˆ é™¤ä»»åŠ¡
client.deleteTask(task.id)
```

### 4. ä½¿ç”¨å®Œæ•´ Request å¯¹è±¡

```kotlin
// åˆ›å»ºä»»åŠ¡ï¼ˆå®Œæ•´ç‰ˆï¼‰
val taskRequest = CreateTaskRequest(
    content = "ä»£ç å®¡æŸ¥",
    description = "å®¡æŸ¥æ–°åŠŸèƒ½ä»£ç ",
    projectId = "2203306141",
    sectionId = section.id,
    priority = 3,
    dueString = "next Monday",
    labels = listOf("code-review", "urgent")
)
val task = client.createTask(taskRequest)

// æ›´æ–°ä»»åŠ¡ï¼ˆå®Œæ•´ç‰ˆï¼‰
val updateRequest = UpdateTaskRequest(
    content = "ä»£ç å®¡æŸ¥ï¼ˆå·²æ›´æ–°ï¼‰",
    description = "å®¡æŸ¥æ–°åŠŸèƒ½ä»£ç å’Œæµ‹è¯•",
    priority = 4,
    dueString = "today at 20:00"
)
client.updateTask(task.id, updateRequest)
```

## æ•°æ®æ¨¡å‹è¯´æ˜

### Project (é¡¹ç›®)
- `id: String` - é¡¹ç›®ID
- `name: String` - é¡¹ç›®åç§°
- `color: String` - é¡¹ç›®é¢œè‰²ï¼ˆå¦‚ "blue", "green", "red" ç­‰ï¼‰
- `parentId: String?` - çˆ¶é¡¹ç›®IDï¼ˆç”¨äºå­é¡¹ç›®ï¼‰
- `order: Int` - æ’åºé¡ºåº
- `commentCount: Int` - è¯„è®ºæ•°é‡
- `isShared: Boolean` - æ˜¯å¦å…±äº«
- `isFavorite: Boolean` - æ˜¯å¦æ”¶è—
- `isInboxProject: Boolean` - æ˜¯å¦ä¸ºæ”¶ä»¶ç®±é¡¹ç›®
- `isTeamInbox: Boolean` - æ˜¯å¦ä¸ºå›¢é˜Ÿæ”¶ä»¶ç®±
- `viewStyle: String` - è§†å›¾æ ·å¼ï¼ˆ"list" æˆ– "board"ï¼‰
- `url: String` - é¡¹ç›® URL

### Section (æ¿å—)
- `id: String` - æ¿å—ID
- `projectId: String` - æ‰€å±é¡¹ç›®ID
- `name: String` - æ¿å—åç§°
- `order: Int` - æ’åºé¡ºåº

### Task (ä»»åŠ¡)
- `id: String` - ä»»åŠ¡ID
- `content: String` - ä»»åŠ¡æ ‡é¢˜
- `description: String` - ä»»åŠ¡æè¿°
- `projectId: String?` - é¡¹ç›®ID
- `sectionId: String?` - æ¿å—ID
- `priority: Int` - ä¼˜å…ˆçº§ï¼ˆ1-4ï¼Œ4æœ€é«˜ï¼‰
- `dueString: String?` - æˆªæ­¢æ—¶é—´ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰
- `dueDate: String?` - æˆªæ­¢æ—¥æœŸ
- `labels: List<String>` - æ ‡ç­¾åˆ—è¡¨
- `isCompleted: Boolean` - æ˜¯å¦å®Œæˆ
- `createdAt: String?` - åˆ›å»ºæ—¶é—´

## é”™è¯¯å¤„ç†

```kotlin
try {
    val task = client.getTask("invalid-id")
} catch (e: TodoistException) {
    println("é”™è¯¯: ${e.message}")
}
```

## æ³¨æ„äº‹é¡¹

1. **API Token**: éœ€è¦ä» Todoist è´¦æˆ·è®¾ç½®ä¸­è·å– API token
2. **ç½‘ç»œè¶…æ—¶**: é»˜è®¤è¿æ¥å’Œè¯»å–è¶…æ—¶å‡ä¸º 10 ç§’
3. **ä¼˜å…ˆçº§**: 1-4ï¼Œå…¶ä¸­ 4 æ˜¯æœ€é«˜ä¼˜å…ˆçº§
4. **æ—¶é—´æ ¼å¼**: `dueString` æ”¯æŒè‡ªç„¶è¯­è¨€ï¼Œå¦‚ "tomorrow"ã€"next Monday at 18:00" ç­‰

## å®Œæ•´ç¤ºä¾‹ä»£ç 

è¯¦è§ `TodoistExample.kt` æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- åŸºæœ¬ä½¿ç”¨æµç¨‹
- æŸ¥è¯¢ä¸åŒæ¡ä»¶çš„ä»»åŠ¡
- æ‰¹é‡æ“ä½œ
- é”™è¯¯å¤„ç†

## API æ–‡æ¡£

Todoist REST API v2 å®˜æ–¹æ–‡æ¡£: https://developer.todoist.com/rest/v2/

## ç®€å•ç¤ºä¾‹ä»£ç 

```kotlin
/**
 * ç®€å•çš„é›†æˆç¤ºä¾‹
 * æ¼”ç¤ºå¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨ TodoistClient
 */
object SimpleExample {

    /**
     * é¡¹ç›®ç®¡ç†ç¤ºä¾‹
     */
    fun projectManagement(token: String) {
        val client = TodoistClient(token)

        // 1. è·å–æ‰€æœ‰é¡¹ç›®
        val projects = client.getProjects()
        println("ğŸ“Š å½“å‰é¡¹ç›®æ€»æ•°: ${projects.size}")
        projects.take(5).forEach {
            println("   - ${it.name} (é¢œè‰²: ${it.color}, æ”¶è—: ${it.isFavorite})")
        }
        println()

        // 2. åˆ›å»ºæ–°é¡¹ç›®
        val project = client.createProject(
            name = "2026å¹´å·¥ä½œè®¡åˆ’",
            color = "blue",
            isFavorite = true,
            viewStyle = "list"
        )
        println("âœ… åˆ›å»ºé¡¹ç›®: ${project.name}")
        println("   ID: ${project.id}")
        println("   é¢œè‰²: ${project.color}")
        println("   è§†å›¾: ${project.viewStyle}")
        println()

        // 3. æ›´æ–°é¡¹ç›®
        val updated = client.updateProject(
            projectId = project.id,
            name = "2026å¹´å·¥ä½œè®¡åˆ’ï¼ˆæ›´æ–°ï¼‰",
            color = "green",
            isFavorite = true
        )
        println("âœ… æ›´æ–°é¡¹ç›®: ${updated.name}, æ–°é¢œè‰²: ${updated.color}")
        println()

        // 4. è·å–é¡¹ç›®è¯¦æƒ…
        val detail = client.getProject(project.id)
        println("ğŸ“‹ é¡¹ç›®è¯¦æƒ…:")
        println("   åç§°: ${detail.name}")
        println("   æ˜¯å¦å…±äº«: ${detail.isShared}")
        println("   è¯„è®ºæ•°: ${detail.comment_count}")
        println()
    }

    /**
     * åŸºç¡€ç¤ºä¾‹ï¼šåˆ›å»ºä»»åŠ¡æµç¨‹
     */
    fun basicTaskFlow(token: String, projectId: String) {
        // 1. åˆå§‹åŒ–å®¢æˆ·ç«¯
        val client = TodoistClient(token)

        // 2. åˆ›å»ºä¸€ä¸ªæ¿å—
        val section = client.createSection(
            name = "ä»Šæ—¥ä»»åŠ¡",
            projectId = projectId
        )
        println("âœ… åˆ›å»ºæ¿å—: ${section.name}")

        // 3. åœ¨æ¿å—ä¸­åˆ›å»ºä»»åŠ¡
        val task = client.createTask(
            content = "å®Œæˆ Todoist å®¢æˆ·ç«¯å¼€å‘",
            description = "å®ç°é¡¹ç›®ã€æ¿å—å’Œä»»åŠ¡çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½",
            sectionId = section.id,
            priority = 4,
            dueString = "today"
        )
        println("âœ… åˆ›å»ºä»»åŠ¡: ${task.content}")

        // 4. æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
        val taskDetail = client.getTask(task.id)
        println("ğŸ“‹ ä»»åŠ¡è¯¦æƒ…:")
        println("   æ ‡é¢˜: ${taskDetail.content}")
        println("   æè¿°: ${taskDetail.description}")
        println("   ä¼˜å…ˆçº§: ${taskDetail.priority}")
        println("   å®ŒæˆçŠ¶æ€: ${if (taskDetail.isCompleted) "å·²å®Œæˆ" else "æœªå®Œæˆ"}")

        // 5. å®Œæˆä»»åŠ¡
        client.closeTask(task.id)
        println("âœ… ä»»åŠ¡å·²å®Œæˆ")
    }

    /**
     * æŸ¥è¯¢ç¤ºä¾‹ï¼šè·å–å’Œç­›é€‰ä»»åŠ¡
     */
    fun queryTasks(token: String, projectId: String) {
        val client = TodoistClient(token)

        // è·å–é¡¹ç›®çš„æ‰€æœ‰ä»»åŠ¡
        val allTasks = client.getTasks(projectId = projectId)
        println("ğŸ“Š é¡¹ç›®ä»»åŠ¡æ€»æ•°: ${allTasks.size}")

        // æŒ‰ä¼˜å…ˆçº§åˆ†ç±»æ˜¾ç¤º
        val highPriority = allTasks.filter { it.priority >= 3 }
        println("ğŸ”´ é«˜ä¼˜å…ˆçº§ä»»åŠ¡ (${highPriority.size}):")
        highPriority.forEach { task ->
            println("   - ${task.content} (ä¼˜å…ˆçº§: ${task.priority})")
        }

        val lowPriority = allTasks.filter { it.priority < 3 }
        println("ğŸŸ¢ ä½ä¼˜å…ˆçº§ä»»åŠ¡ (${lowPriority.size}):")
        lowPriority.forEach { task ->
            println("   - ${task.content} (ä¼˜å…ˆçº§: ${task.priority})")
        }
    }

    /**
     * æ¿å—ç®¡ç†ç¤ºä¾‹
     */
    fun manageSections(token: String, projectId: String) {
        val client = TodoistClient(token)

        // åˆ›å»ºå¤šä¸ªæ¿å—
        val sectionNames = listOf("å¾…åŠ", "è¿›è¡Œä¸­", "å·²å®Œæˆ")
        val sections = sectionNames.map { name ->
            client.createSection(name, projectId)
        }
        println("âœ… åˆ›å»ºäº† ${sections.size} ä¸ªæ¿å—")

        // åˆ—å‡ºæ‰€æœ‰æ¿å—
        val allSections = client.getSections(projectId = projectId)
        println("ğŸ“‹ é¡¹ç›®æ¿å—åˆ—è¡¨:")
        allSections.forEach { section ->
            println("   - ${section.name} (ID: ${section.id})")
        }
    }

    /**
     * é”™è¯¯å¤„ç†ç¤ºä¾‹
     */
    fun errorHandlingExample(token: String) {
        val client = TodoistClient(token)

        try {
            // å°è¯•è·å–ä¸å­˜åœ¨çš„ä»»åŠ¡
            val task = client.getTask("invalid-task-id-12345")
            println("ä»»åŠ¡: ${task.content}")
        } catch (e: TodoistException) {
            println("âŒ è·å–ä»»åŠ¡å¤±è´¥: ${e.message}")
        }

        // ä½¿ç”¨å¸ƒå°”è¿”å›å€¼çš„æ–¹æ³•ä¸ä¼šæŠ›å‡ºå¼‚å¸¸
        val deleted = client.deleteTask("invalid-task-id")
        if (deleted) {
            println("âœ… åˆ é™¤æˆåŠŸ")
        } else {
            println("âš ï¸ åˆ é™¤å¤±è´¥ï¼ˆä»»åŠ¡å¯èƒ½ä¸å­˜åœ¨ï¼‰")
        }
    }

    /**
     * å®Œæ•´å·¥ä½œæµç¤ºä¾‹
     */
    fun completeWorkflow(token: String) {
        val client = TodoistClient(token)

        println("=== å¼€å§‹å®Œæ•´å·¥ä½œæµ ===\n")

        // æ­¥éª¤1: åˆ›å»ºé¡¹ç›®
        println("æ­¥éª¤1: åˆ›å»ºé¡¹ç›®")
        val project = client.createProject(
            name = "å‘¨è®¡åˆ’é¡¹ç›®",
            color = "blue",
            isFavorite = true
        )
        println("âœ… é¡¹ç›®åˆ›å»ºæˆåŠŸ: ${project.name} (ID: ${project.id})\n")

        // æ­¥éª¤2: åˆ›å»ºæ¿å—
        println("æ­¥éª¤2: åˆ›å»ºå·¥ä½œæ¿å—")
        val section = client.createSection("æœ¬å‘¨ä»»åŠ¡", project.id)
        println("âœ… æ¿å—åˆ›å»ºæˆåŠŸ: ${section.name}\n")

        // æ­¥éª¤3: æ·»åŠ å¤šä¸ªä»»åŠ¡
        println("æ­¥éª¤3: æ·»åŠ ä»»åŠ¡")
        val taskContents = listOf(
            "ç¼–å†™é¡¹ç›®æ–‡æ¡£" to 3,
            "ä»£ç å®¡æŸ¥" to 4,
            "æ›´æ–°ä¾èµ–åŒ…" to 2
        )

        val tasks = taskContents.map { (content, priority) ->
            client.createTask(
                content = content,
                sectionId = section.id,
                priority = priority,
                dueString = "this week"
            ).also {
                println("âœ… åˆ›å»ºä»»åŠ¡: $content (ä¼˜å…ˆçº§: $priority)")
            }
        }
        println()

        // æ­¥éª¤4: æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
        println("æ­¥éª¤4: æŸ¥çœ‹æ¿å—ä»»åŠ¡")
        val sectionTasks = client.getTasks(sectionId = section.id)
        sectionTasks.sortedByDescending { it.priority }.forEach { task ->
            println("ğŸ“‹ ${task.content} - ä¼˜å…ˆçº§: ${task.priority}")
        }
        println()

        // æ­¥éª¤5: å®Œæˆæœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡
        println("æ­¥éª¤5: å®Œæˆé«˜ä¼˜å…ˆçº§ä»»åŠ¡")
        val highestPriorityTask = tasks.maxByOrNull { it.priority }
        if (highestPriorityTask != null) {
            client.closeTask(highestPriorityTask.id)
            println("âœ… å·²å®Œæˆ: ${highestPriorityTask.content}\n")
        }

        println("=== å®Œæ•´å·¥ä½œæµå®Œæˆ ===")
    }
}

/**
 * ä¸»å‡½æ•°ç¤ºä¾‹ï¼ˆå¦‚éœ€æµ‹è¯•ï¼Œè¯·æ›¿æ¢ä¸ºçœŸå®çš„ tokenï¼‰
 */
fun main() {
    // è¯·æ›¿æ¢ä¸ºä½ çš„å®é™… token
    val token = "your-api-token-here"

    // å–æ¶ˆæ³¨é‡Šä»¥è¿è¡Œç¤ºä¾‹
    // SimpleExample.projectManagement(token)
    // SimpleExample.basicTaskFlow(token, "your-project-id")
    // SimpleExample.queryTasks(token, "your-project-id")
    // SimpleExample.manageSections(token, "your-project-id")
    // SimpleExample.errorHandlingExample(token)
    // SimpleExample.completeWorkflow(token)

    println("è¯·è®¾ç½®çœŸå®çš„ token åå†è¿è¡Œç¤ºä¾‹")
}
```